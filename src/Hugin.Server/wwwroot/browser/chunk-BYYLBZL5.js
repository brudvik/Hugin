import{b as L,d as Q,f as R,k as G,l as H,m as q,q as J}from"./chunk-VCIVRVDU.js";import{a as X}from"./chunk-CG4X7TY4.js";import{$a as _,Ga as h,La as b,Oa as M,Qa as k,Rb as K,Sa as C,Tb as W,Ua as w,Ub as j,V as O,Va as y,Wa as E,Xa as t,Ya as n,Z as F,Za as m,_a as U,ab as d,eb as a,fb as g,ga as u,gb as S,ha as f,hb as $,ib as B,jb as P,kb as V,lb as I,nb as A,rb as D,sb as N,tb as z,za as l}from"./chunk-UR2BHKY7.js";var Y=(i,c)=>c.nickname,Z=(i,c,e)=>({"bg-success":i,"bg-warning":c,"bg-secondary":e});function ee(i,c){i&1&&(t(0,"div",26)(1,"div",27)(2,"span",28),a(3,"Laster..."),n()()())}function te(i,c){i&1&&(t(0,"div",26),m(1,"i",29),t(2,"p",30),a(3,"Ingen brukere funnet"),n()())}function ne(i,c){if(i&1&&(t(0,"span",49),a(1),n()),i&2){let e=c.$implicit;l(),S("#",e,"")}}function ie(i,c){if(i&1&&(t(0,"span",30),a(1),n()),i&2){let e=d(2).$implicit;l(),S("+",e.channels.length-3,"")}}function re(i,c){if(i&1&&(y(0,ne,2,1,"span",49,w),b(2,ie,2,1,"span",30)),i&2){let e=d().$implicit;E(e.channels.slice(0,3)),l(2),C(e.channels.length>3?2:-1)}}function ae(i,c){i&1&&(t(0,"span",30),a(1,"-"),n())}function le(i,c){i&1&&(t(0,"span",40),m(1,"i",50),n())}function oe(i,c){i&1&&(t(0,"span",41),m(1,"i",51),n())}function se(i,c){if(i&1){let e=U();t(0,"tr")(1,"td")(2,"div",35)(3,"div",36),m(4,"i",37),n(),t(5,"div")(6,"div",38),a(7),n(),t(8,"small",30),a(9),n()()()(),t(10,"td")(11,"code",30),a(12),n()(),t(13,"td"),b(14,re,3,1)(15,ae,2,0,"span",30),n(),t(16,"td")(17,"span",39),a(18),n(),b(19,le,2,0,"span",40)(20,oe,2,0,"span",41),n(),t(21,"td"),a(22),n(),t(23,"td",33)(24,"div",42)(25,"button",43),_("click",function(){let r=u(e).$implicit,s=d(2);return f(s.showUserDetails(r))}),m(26,"i",44),n(),t(27,"button",45),_("click",function(){let r=u(e).$implicit,s=d(2);return f(s.sendMessage(r))}),m(28,"i",46),n(),t(29,"button",47),_("click",function(){let r=u(e).$implicit,s=d(2);return f(s.disconnectUser(r))}),m(30,"i",48),n()()()()}if(i&2){let e=c.$implicit,o=d(2);l(7),g(e.nickname),l(2),$("",e.username,"@",e.hostname,""),l(3),g(e.hostname),l(2),C(e.channels&&e.channels.length>0?14:15),l(3),M("ngClass",D(10,Z,e.isOnline&&!e.isAway,e.isAway,!e.isOnline)),l(),S(" ",e.isAway?"Borte":e.isOnline?"Online":"Offline"," "),l(),C(e.isOperator?19:-1),l(),C(e.isRegistered?20:-1),l(2),g(o.formatTime(e.connectedAt))}}function ce(i,c){if(i&1){let e=U();t(0,"li",53)(1,"button",54),_("click",function(){let r=u(e).$implicit,s=d(3);return f(s.goToPage(r))}),a(2),n()()}if(i&2){let e=c.$implicit,o=d(3);k("active",e===o.currentPage()),l(2),g(e)}}function de(i,c){if(i&1){let e=U();t(0,"div",34)(1,"small",30),a(2),n(),t(3,"nav")(4,"ul",52)(5,"li",53)(6,"button",54),_("click",function(){u(e);let r=d(2);return f(r.goToPage(r.currentPage()-1))}),m(7,"i",55),n()(),y(8,ce,3,3,"li",56,w),t(10,"li",53)(11,"button",54),_("click",function(){u(e);let r=d(2);return f(r.goToPage(r.currentPage()+1))}),m(12,"i",57),n()()()()()}if(i&2){let e=d(2);l(2),B(" Viser ",(e.currentPage()-1)*e.pageSize+1," - ",e.Math.min(e.currentPage()*e.pageSize,e.totalItems())," av ",e.totalItems()," "),l(3),k("disabled",e.currentPage()===1),l(3),E(e.visiblePages()),l(2),k("disabled",e.currentPage()===e.totalPages())}}function me(i,c){if(i&1&&(t(0,"div",31)(1,"table",32)(2,"thead")(3,"tr")(4,"th"),a(5,"Bruker"),n(),t(6,"th"),a(7,"Vert"),n(),t(8,"th"),a(9,"Kanaler"),n(),t(10,"th"),a(11,"Status"),n(),t(12,"th"),a(13,"Tilkoblet"),n(),t(14,"th",33),a(15,"Handlinger"),n()()(),t(16,"tbody"),y(17,se,31,14,"tr",null,Y),n()()(),b(19,de,13,7,"div",34)),i&2){let e=d();l(17),E(e.users()),l(2),C(e.totalPages()>1?19:-1)}}function _e(i,c){if(i&1&&(t(0,"span",49),a(1),n()),i&2){let e=c.$implicit;l(),S("#",e,"")}}function pe(i,c){if(i&1&&y(0,_e,2,1,"span",49,w),i&2){let e,o=d(2);E((e=o.selectedUser())==null?null:e.channels)}}function ue(i,c){i&1&&(t(0,"span",30),a(1,"Ingen"),n())}function fe(i,c){if(i&1){let e=U();t(0,"div",58),_("click",function(r){u(e);let s=d();return f(s.closeModal(r))}),t(1,"div",59)(2,"div",60)(3,"div",61)(4,"h5",62),m(5,"i",63),a(6),n(),t(7,"button",64),_("click",function(){u(e);let r=d();return f(r.selectedUser.set(null))}),n()(),t(8,"div",65)(9,"dl",66)(10,"dt",67),a(11,"Brukernavn"),n(),t(12,"dd",68),a(13),n(),t(14,"dt",67),a(15,"Vert"),n(),t(16,"dd",68)(17,"code"),a(18),n()(),t(19,"dt",67),a(20,"Virkelig navn"),n(),t(21,"dd",68),a(22),n(),t(23,"dt",67),a(24,"Tilkoblet"),n(),t(25,"dd",68),a(26),N(27,"date"),n(),t(28,"dt",67),a(29,"Inaktiv siden"),n(),t(30,"dd",68),a(31),n(),t(32,"dt",67),a(33,"Kanaler"),n(),t(34,"dd",68),b(35,pe,2,0)(36,ue,2,0,"span",30),n()()(),t(37,"div",69)(38,"button",70),_("click",function(){u(e);let r=d();return f(r.selectedUser.set(null))}),a(39," Lukk "),n(),t(40,"button",71),_("click",function(){u(e);let r=d();return f(r.disconnectUser(r.selectedUser()))}),m(41,"i",72),a(42,"Koble fra "),n()()()()(),m(43,"div",73)}if(i&2){let e,o,r,s,p,v,T,x=d();l(6),S(" ",(e=x.selectedUser())==null?null:e.nickname," "),l(7),g((o=x.selectedUser())==null?null:o.username),l(5),g((r=x.selectedUser())==null?null:r.hostname),l(4),g(((s=x.selectedUser())==null?null:s.realName)||"-"),l(4),g(z(27,7,(p=x.selectedUser())==null?null:p.connectedAt,"medium")),l(5),g((v=x.selectedUser())!=null&&v.idleTime?x.formatDuration(x.selectedUser().idleTime):"-"),l(4),C(!((T=x.selectedUser())==null||T.channels==null)&&T.channels.length?35:36)}}var ye=(()=>{class i{apiService=O(X);loading=h(!1);users=h([]);selectedUser=h(null);searchQuery="";filterStatus="";currentPage=h(1);pageSize=20;totalItems=h(0);totalPages=h(0);Math=Math;ngOnInit(){this.refresh()}refresh(){this.loading.set(!0),this.apiService.getUsers(this.currentPage(),this.pageSize,this.searchQuery||void 0).subscribe({next:e=>{this.users.set(e.items),this.totalItems.set(e.totalCount),this.totalPages.set(e.totalPages),this.loading.set(!1)},error:()=>{this.loading.set(!1)}})}search(){this.currentPage.set(1),this.refresh()}goToPage(e){e<1||e>this.totalPages()||(this.currentPage.set(e),this.refresh())}visiblePages(){let e=this.totalPages(),o=this.currentPage(),r=[],s=Math.max(1,o-2),p=Math.min(e,o+2);p-s<4&&(s===1?p=Math.min(e,5):s=Math.max(1,e-4));for(let v=s;v<=p;v++)r.push(v);return r}formatTime(e){if(!e)return"-";let o=new Date(e),s=Math.floor((new Date().getTime()-o.getTime())/1e3);return s<60?"N\xE5":s<3600?`${Math.floor(s/60)}m`:s<86400?`${Math.floor(s/3600)}t`:`${Math.floor(s/86400)}d`}formatDuration(e){return e<60?`${e}s`:e<3600?`${Math.floor(e/60)}m`:`${Math.floor(e/3600)}t ${Math.floor(e%3600/60)}m`}showUserDetails(e){this.selectedUser.set(e)}sendMessage(e){let o=prompt(`Send melding til ${e.nickname}:`);o&&this.apiService.sendNotice(e.nickname,o).subscribe({next:()=>alert("Melding sendt!"),error:()=>alert("Kunne ikke sende melding")})}disconnectUser(e){if(confirm(`Er du sikker p\xE5 at du vil koble fra ${e.nickname}?`)){let o=prompt("Grunn (valgfritt):")||"Frakoblet av administrator";this.apiService.disconnectUser(e.nickname,o).subscribe({next:()=>{this.selectedUser.set(null),this.refresh()},error:()=>alert("Kunne ikke koble fra bruker")})}}closeModal(e){e.target.classList.contains("modal")&&this.selectedUser.set(null)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=F({type:i,selectors:[["app-users"]],standalone:!0,features:[A],decls:40,vars:7,consts:[[1,"users-page"],[1,"page-header","mb-4"],[1,"text-muted","mb-0"],[1,"header-actions"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fas","fa-sync-alt"],[1,"d-none","d-sm-inline","ms-2"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text","placeholder","S\xF8k etter bruker...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],["value","online"],["value","away"],["value","registered"],[1,"col-md-2"],[1,"btn","btn-primary","w-100",3,"click"],[1,"fas","fa-search","me-2"],[1,"card"],[1,"card-body","p-0"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"fas","fa-users","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"text-end"],[1,"card-footer","d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center"],[1,"user-avatar","me-2"],[1,"fas","fa-user"],[1,"fw-medium"],[1,"badge",3,"ngClass"],[1,"badge","bg-info","ms-1"],[1,"badge","bg-primary","ms-1"],[1,"btn-group","btn-group-sm"],["title","Vis detaljer",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-eye"],["title","Send melding",1,"btn","btn-outline-warning",3,"click"],[1,"fas","fa-comment"],["title","Koble fra",1,"btn","btn-outline-danger",3,"click"],[1,"fas","fa-times"],[1,"badge","bg-secondary","me-1"],[1,"fas","fa-star"],[1,"fas","fa-check"],[1,"pagination","pagination-sm","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"fas","fa-chevron-left"],[1,"page-item",3,"active"],[1,"fas","fa-chevron-right"],["tabindex","-1",1,"modal","show","d-block",3,"click"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fas","fa-user","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","mb-0"],[1,"col-sm-4"],[1,"col-sm-8"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"fas","fa-times","me-2"],[1,"modal-backdrop","show"]],template:function(o,r){o&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),a(4,"Brukere"),n(),t(5,"p",2),a(6,"Administrer tilkoblede og registrerte brukere"),n()(),t(7,"div",3)(8,"button",4),_("click",function(){return r.refresh()}),m(9,"i",5),t(10,"span",6),a(11,"Oppdater"),n()()()(),t(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11)(17,"span",12),m(18,"i",13),n(),t(19,"input",14),I("ngModelChange",function(p){return V(r.searchQuery,p)||(r.searchQuery=p),p}),_("keyup.enter",function(){return r.search()}),n()()(),t(20,"div",15)(21,"select",16),I("ngModelChange",function(p){return V(r.filterStatus,p)||(r.filterStatus=p),p}),_("change",function(){return r.refresh()}),t(22,"option",17),a(23,"Alle statuser"),n(),t(24,"option",18),a(25,"Tilkoblet"),n(),t(26,"option",19),a(27,"Borte"),n(),t(28,"option",20),a(29,"Registrert"),n()()(),t(30,"div",21)(31,"button",22),_("click",function(){return r.search()}),m(32,"i",23),a(33,"S\xF8k "),n()()()()(),t(34,"div",24)(35,"div",25),b(36,ee,4,0,"div",26)(37,te,4,0,"div",26)(38,me,20,1),n()()(),b(39,fe,44,10)),o&2&&(l(8),M("disabled",r.loading()),l(),k("fa-spin",r.loading()),l(10),P("ngModel",r.searchQuery),l(2),P("ngModel",r.filterStatus),l(15),C(r.loading()?36:r.users().length===0?37:38),l(3),C(r.selectedUser()?39:-1))},dependencies:[j,K,W,J,H,q,L,G,Q,R],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.25rem}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:var(--bs-primary);display:flex;align-items:center;justify-content:center;color:#fff;font-size:.875rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.05em;color:var(--bs-gray-400);border-bottom-width:1px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.modal[_ngcontent-%COMP%]{background:#00000080}.modal-content[_ngcontent-%COMP%]{background:var(--card-bg);border-color:var(--card-border)}.modal-header[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border-color:var(--bs-border-color)}code[_ngcontent-%COMP%]{background:#0000004d;padding:.125rem .375rem;border-radius:.25rem}"]})}return i})();export{ye as UsersComponent};
