import{b as z,d as N,f as j,h as G,k as U,l as K,m as H,o as R,q as Z}from"./chunk-VCIVRVDU.js";import{a as q}from"./chunk-CG4X7TY4.js";import{$a as c,Ga as x,La as y,Oa as h,Qa as b,Rb as L,Sa as S,Tb as A,Ub as W,V as B,Va as F,Wa as T,Xa as t,Ya as n,Z as P,Za as g,_a as E,ab as d,eb as a,fb as _,ga as p,gb as f,ha as u,jb as v,kb as C,lb as k,nb as V,rb as O,sb as I,tb as D,za as r}from"./chunk-UR2BHKY7.js";var J=(o,m)=>m.id,Q=(o,m,e)=>({"bg-warning":o,"bg-danger":m,"bg-info":e});function X(o,m){o&1&&(t(0,"div",17)(1,"div",27)(2,"span",28),a(3,"Laster..."),n()()())}function Y(o,m){o&1&&(t(0,"div",17),g(1,"i",29),t(2,"p",30),a(3,"Ingen utestengelser"),n()())}function $(o,m){o&1&&(t(0,"span",36),a(1,"Permanent"),n())}function ee(o,m){if(o&1&&(t(0,"span"),a(1),n()),o&2){let e=d().$implicit,l=d(2);b("text-warning",l.isExpiringSoon(e)),r(),f(" ",l.formatExpiry(e.expiresAt)," ")}}function te(o,m){o&1&&(t(0,"span",30),a(1,"-"),n())}function ne(o,m){if(o&1){let e=E();t(0,"tr")(1,"td")(2,"span",34),a(3),n()(),t(4,"td")(5,"code"),a(6),n()(),t(7,"td")(8,"span",35),a(9),n()(),t(10,"td")(11,"small"),a(12),n(),g(13,"br"),t(14,"small",30),a(15),I(16,"date"),n()(),t(17,"td"),y(18,$,2,0,"span",36)(19,ee,2,3,"span",37)(20,te,2,0,"span",30),n(),t(21,"td",32)(22,"div",38)(23,"button",39),c("click",function(){let i=p(e).$implicit,s=d(2);return u(s.editBan(i))}),g(24,"i",40),n(),t(25,"button",41),c("click",function(){let i=p(e).$implicit,s=d(2);return u(s.removeBan(i))}),g(26,"i",42),n()()()()}if(o&2){let e=m.$implicit,l=d(2);b("table-warning",l.isExpiringSoon(e))("table-danger",e.isPermanent),r(2),h("ngClass",O(15,Q,e.type==="kline",e.type==="gline",e.type==="zline")),r(),f(" ",e.type.toUpperCase()," "),r(3),_(e.mask),r(2),h("title",e.reason),r(),f(" ",e.reason," "),r(3),_(e.setBy),r(3),_(D(16,12,e.setAt,"short")),r(3),S(e.isPermanent?18:e.expiresAt?19:20)}}function ie(o,m){if(o&1&&(t(0,"div",18)(1,"table",31)(2,"thead")(3,"tr")(4,"th"),a(5,"Type"),n(),t(6,"th"),a(7,"Maske"),n(),t(8,"th"),a(9,"Grunn"),n(),t(10,"th"),a(11,"Satt av"),n(),t(12,"th"),a(13,"Utl\xF8per"),n(),t(14,"th",32),a(15,"Handlinger"),n()()(),t(16,"tbody"),F(17,ne,27,19,"tr",33,J),n()()()),o&2){let e=d();r(17),T(e.filteredBans())}}function ae(o,m){if(o&1){let e=E();t(0,"div",70)(1,"input",75),k("ngModelChange",function(i){p(e);let s=d(2);return C(s.banForm.customDays,i)||(s.banForm.customDays=i),u(i)}),n()()}if(o&2){let e=d(2);r(),v("ngModel",e.banForm.customDays)}}function re(o,m){if(o&1){let e=E();t(0,"div",43),c("click",function(i){p(e);let s=d();return u(s.closeModal(i))}),t(1,"div",44)(2,"div",45)(3,"div",46)(4,"h5",47),a(5),n(),t(6,"button",48),c("click",function(){p(e);let i=d();return u(i.showModal.set(!1))}),n()(),t(7,"div",49)(8,"div",50)(9,"label",51),a(10,"Type"),n(),t(11,"select",52),k("ngModelChange",function(i){p(e);let s=d();return C(s.banForm.type,i)||(s.banForm.type=i),u(i)}),t(12,"option",53),a(13,"K-Line (lokal)"),n(),t(14,"option",54),a(15,"G-Line (global)"),n(),t(16,"option",55),a(17,"Z-Line (IP)"),n()()(),t(18,"div",50)(19,"label",51),a(20,"Maske"),n(),t(21,"input",56),k("ngModelChange",function(i){p(e);let s=d();return C(s.banForm.mask,i)||(s.banForm.mask=i),u(i)}),n(),t(22,"small",57),a(23),n()(),t(24,"div",50)(25,"label",51),a(26,"Grunn"),n(),t(27,"textarea",58),k("ngModelChange",function(i){p(e);let s=d();return C(s.banForm.reason,i)||(s.banForm.reason=i),u(i)}),n()(),t(28,"div",50)(29,"label",51),a(30,"Varighet"),n(),t(31,"div",59)(32,"div",60)(33,"select",61),k("ngModelChange",function(i){p(e);let s=d();return C(s.banForm.duration,i)||(s.banForm.duration=i),u(i)}),t(34,"option",62),a(35,"1 time"),n(),t(36,"option",63),a(37,"6 timer"),n(),t(38,"option",64),a(39,"1 dag"),n(),t(40,"option",65),a(41,"1 uke"),n(),t(42,"option",66),a(43,"30 dager"),n(),t(44,"option",67),a(45,"1 \xE5r"),n(),t(46,"option",68),a(47,"Permanent"),n(),t(48,"option",69),a(49,"Egendefinert..."),n()()(),y(50,ae,2,1,"div",70),n()()(),t(51,"div",71)(52,"button",72),c("click",function(){p(e);let i=d();return u(i.showModal.set(!1))}),a(53," Avbryt "),n(),t(54,"button",73),c("click",function(){p(e);let i=d();return u(i.saveBan())}),g(55,"i",7),a(56),n()()()()(),g(57,"div",74)}if(o&2){let e=d();r(5),f(" ",e.editingBan()?"Rediger utestengelse":"Ny utestengelse"," "),r(6),v("ngModel",e.banForm.type),h("disabled",!!e.editingBan()),r(10),v("ngModel",e.banForm.mask),h("placeholder",e.getMaskPlaceholder())("disabled",!!e.editingBan()),r(2),f(" ",e.getMaskHelp()," "),r(4),v("ngModel",e.banForm.reason),r(6),v("ngModel",e.banForm.duration),r(17),S(e.banForm.duration==="custom"?50:-1),r(6),f(" ",e.editingBan()?"Oppdater":"Legg til utestengelse"," ")}}var ge=(()=>{class o{apiService=B(q);loading=x(!1);bans=x([]);filterType=x("all");showModal=x(!1);editingBan=x(null);banForm={type:"kline",mask:"",reason:"",duration:"1d",customDays:7};ngOnInit(){this.refresh()}refresh(){this.loading.set(!0),this.apiService.getBans().subscribe({next:e=>{this.bans.set(e),this.loading.set(!1)},error:()=>{this.loading.set(!1)}})}filteredBans(){let e=this.filterType();return e==="all"?this.bans():this.bans().filter(l=>l.type===e)}totalCount(){return this.bans().length}klineCount(){return this.bans().filter(e=>e.type==="kline").length}glineCount(){return this.bans().filter(e=>e.type==="gline").length}zlineCount(){return this.bans().filter(e=>e.type==="zline").length}isExpiringSoon(e){if(e.isPermanent||!e.expiresAt)return!1;let i=(new Date(e.expiresAt).getTime()-Date.now())/(1e3*60*60);return i>0&&i<24}formatExpiry(e){let l=new Date(e),i=new Date,s=l.getTime()-i.getTime();if(s<=0)return"Utl\xF8pt";let w=Math.floor(s/(1e3*60*60)),M=Math.floor(w/24);return M>0?`${M}d ${w%24}t`:w>0?`${w}t`:`${Math.floor(s/(1e3*60))}m`}getMaskPlaceholder(){switch(this.banForm.type){case"kline":return"*@*.example.com";case"gline":return"*@*.example.com";case"zline":return"192.168.1.*";default:return"*@*"}}getMaskHelp(){switch(this.banForm.type){case"kline":case"gline":return"Format: ident@host (bruk * som wildcard)";case"zline":return"Format: IP-adresse eller CIDR (f.eks. 192.168.1.0/24)";default:return""}}showAddModal(){this.editingBan.set(null),this.banForm={type:"kline",mask:"",reason:"",duration:"1d",customDays:7},this.showModal.set(!0)}editBan(e){this.editingBan.set(e),this.banForm={type:e.type,mask:e.mask,reason:e.reason,duration:e.isPermanent?"permanent":"1d",customDays:7},this.showModal.set(!0)}saveBan(){if(!this.banForm.mask||!this.banForm.reason){alert("Maske og grunn er p\xE5krevd");return}let e=null;switch(this.banForm.duration){case"1h":e=3600;break;case"6h":e=6*3600;break;case"1d":e=86400;break;case"7d":e=7*86400;break;case"30d":e=30*86400;break;case"365d":e=365*86400;break;case"permanent":e=null;break;case"custom":e=this.banForm.customDays*86400;break}let l={type:this.banForm.type,mask:this.banForm.mask,reason:this.banForm.reason,duration:e,isPermanent:this.banForm.duration==="permanent"};this.editingBan()?this.apiService.updateBan(this.editingBan().id,l).subscribe({next:()=>{this.showModal.set(!1),this.refresh()},error:i=>{alert("Kunne ikke oppdatere utestengelse: "+(i.error?.message||"Ukjent feil"))}}):this.apiService.createBan(l).subscribe({next:()=>{this.showModal.set(!1),this.refresh()},error:i=>{alert("Kunne ikke opprette utestengelse: "+(i.error?.message||"Ukjent feil"))}})}removeBan(e){confirm(`Er du sikker p\xE5 at du vil fjerne utestengelsen for ${e.mask}?`)&&this.apiService.deleteBan(e.id).subscribe({next:()=>{this.refresh()},error:l=>{alert("Kunne ikke fjerne utestengelse: "+(l.error?.message||"Ukjent feil"))}})}closeModal(e){e.target.classList.contains("modal")&&this.showModal.set(!1)}static \u0275fac=function(l){return new(l||o)};static \u0275cmp=P({type:o,selectors:[["app-bans"]],standalone:!0,features:[V],decls:68,vars:17,consts:[[1,"bans-page"],[1,"page-header","mb-4"],[1,"text-muted","mb-0"],[1,"header-actions"],[1,"btn","btn-outline-secondary","me-2",3,"click","disabled"],[1,"fas","fa-sync-alt"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-ban","me-2"],[1,"nav","nav-tabs","mb-4"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"badge","bg-secondary","ms-1"],[1,"badge","bg-warning","ms-1"],[1,"badge","bg-danger","ms-1"],[1,"badge","bg-info","ms-1"],[1,"card"],[1,"card-body","p-0"],[1,"text-center","py-5"],[1,"table-responsive"],[1,"row","mt-4"],[1,"col-md-4"],[1,"card","h-100"],[1,"card-body"],[1,"badge","bg-warning","me-2"],[1,"text-muted","small","mb-0"],[1,"badge","bg-danger","me-2"],[1,"badge","bg-info","me-2"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"fas","fa-ban","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"table","table-hover","mb-0"],[1,"text-end"],[3,"table-warning","table-danger"],[1,"badge",3,"ngClass"],[1,"ban-reason",3,"title"],[1,"badge","bg-dark"],[3,"text-warning"],[1,"btn-group","btn-group-sm"],["title","Rediger",1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-edit"],["title","Fjern",1,"btn","btn-outline-success",3,"click"],[1,"fas","fa-times"],["tabindex","-1",1,"modal","show","d-block",3,"click"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value","kline"],["value","gline"],["value","zline"],["type","text",1,"form-control",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"form-text","text-muted"],["rows","2","placeholder","Grunn for utestengelse...",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-8"],[1,"form-select",3,"ngModelChange","ngModel"],["value","1h"],["value","6h"],["value","1d"],["value","7d"],["value","30d"],["value","365d"],["value","permanent"],["value","custom"],[1,"col-4"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"modal-backdrop","show"],["type","number","placeholder","Dager","min","1",1,"form-control",3,"ngModelChange","ngModel"]],template:function(l,i){l&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),a(4,"Utestengelser"),n(),t(5,"p",2),a(6,"Administrer server-bans (K-lines, G-lines)"),n()(),t(7,"div",3)(8,"button",4),c("click",function(){return i.refresh()}),g(9,"i",5),n(),t(10,"button",6),c("click",function(){return i.showAddModal()}),g(11,"i",7),a(12,"Ny utestengelse "),n()()(),t(13,"ul",8)(14,"li",9)(15,"button",10),c("click",function(){return i.filterType.set("all")}),a(16," Alle "),t(17,"span",11),a(18),n()()(),t(19,"li",9)(20,"button",10),c("click",function(){return i.filterType.set("kline")}),a(21," K-Lines "),t(22,"span",12),a(23),n()()(),t(24,"li",9)(25,"button",10),c("click",function(){return i.filterType.set("gline")}),a(26," G-Lines "),t(27,"span",13),a(28),n()()(),t(29,"li",9)(30,"button",10),c("click",function(){return i.filterType.set("zline")}),a(31," Z-Lines "),t(32,"span",14),a(33),n()()()(),t(34,"div",15)(35,"div",16),y(36,X,4,0,"div",17)(37,Y,4,0,"div",17)(38,ie,19,0,"div",18),n()(),t(39,"div",19)(40,"div",20)(41,"div",21)(42,"div",22)(43,"h5")(44,"span",23),a(45,"K-LINE"),n(),a(46,"Lokal utestengelse"),n(),t(47,"p",24),a(48," Stenger ute brukere basert p\xE5 ident@host fra denne serveren. P\xE5virker kun tilkoblinger til denne serveren. "),n()()()(),t(49,"div",20)(50,"div",21)(51,"div",22)(52,"h5")(53,"span",25),a(54,"G-LINE"),n(),a(55,"Global utestengelse"),n(),t(56,"p",24),a(57," Stenger ute brukere fra hele nettverket. Synkroniseres mellom alle servere i nettverket. "),n()()()(),t(58,"div",20)(59,"div",21)(60,"div",22)(61,"h5")(62,"span",26),a(63,"Z-LINE"),n(),a(64,"IP-utestengelse"),n(),t(65,"p",24),a(66," Stenger ute basert p\xE5 IP-adresse. Brukes for alvorlige tilfeller eller botnett. "),n()()()()()(),y(67,re,58,11)),l&2&&(r(8),h("disabled",i.loading()),r(),b("fa-spin",i.loading()),r(6),b("active",i.filterType()==="all"),r(3),_(i.totalCount()),r(2),b("active",i.filterType()==="kline"),r(3),_(i.klineCount()),r(2),b("active",i.filterType()==="gline"),r(3),_(i.glineCount()),r(2),b("active",i.filterType()==="zline"),r(3),_(i.zlineCount()),r(3),S(i.loading()?36:i.filteredBans().length===0?37:38),r(31),S(i.showModal()?67:-1))},dependencies:[W,L,A,Z,K,H,z,G,U,N,R,j],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.25rem}.nav-tabs[_ngcontent-%COMP%]{border-color:var(--bs-border-color)}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:var(--bs-gray-400);border-color:transparent}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--bs-light);border-color:transparent}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:var(--bs-light);background:var(--card-bg);border-color:var(--bs-border-color) var(--bs-border-color) var(--card-bg)}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.05em;color:var(--bs-gray-400);border-bottom-width:1px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.ban-reason[_ngcontent-%COMP%]{display:inline-block;max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}code[_ngcontent-%COMP%]{background:#0000004d;padding:.125rem .375rem;border-radius:.25rem}.modal[_ngcontent-%COMP%]{background:#00000080}.modal-content[_ngcontent-%COMP%]{background:var(--card-bg);border-color:var(--card-border)}.modal-header[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{border-color:var(--bs-border-color)}"]})}return o})();export{ge as BansComponent};
